<Project>
  <PropertyGroup>
    <TargetFramework>netcoreapp3.1</TargetFramework>
    <NETCoreAppMaximumVersion>3.1</NETCoreAppMaximumVersion>
    <RuntimeFrameworkVersion>$(MicrosoftNETCoreAppPackageVersion)</RuntimeFrameworkVersion>
  </PropertyGroup>

  <ItemGroup>
    <!-- Since we don't have an SDK that knows about 3.1 framework, we should specify it manually. -->
    <KnownAppHostPack Include="@(KnownAppHostPack->WithMetadataValue('TargetFramework', 'netcoreapp3.0'))"
        TargetFramework="netcoreapp3.1" />
    <KnownFrameworkReference Include="@(KnownFrameworkReference->WithMetadataValue('TargetFramework', 'netcoreapp3.0'))"
        TargetFramework="netcoreapp3.1" />

    <FrameworkReference Update="Microsoft.NETCore.App" Condition="'$(TargetFramework)' == 'netcoreapp3.1'" RuntimeFrameworkVersion="$(RuntimeFrameworkVersion)" TargetingPackVersion="$(RuntimeFrameworkVersion)" />

    <KnownFrameworkReference Remove="Microsoft.AspNetCore.App" />
    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App" />
    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WPF" />
    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WindowsForms" />
  </ItemGroup>

  <Target Name="Patch30PackTo31" BeforeTargets="ResolveTargetingPacks">
    <ItemGroup>
      <TargetingPack Update="Microsoft.NETCore.App" Condition="'$(TargetFramework)' == 'netcoreapp3.1'" TargetFramework="netcoreapp3.0" />
    </ItemGroup>
  </Target>
</Project>
