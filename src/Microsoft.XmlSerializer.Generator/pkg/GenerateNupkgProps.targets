<Project>
  <PropertyGroup>
      <BuildDependsOn>
        GenerateNupkgProps;
        $(BuildDependsOn)
      </BuildDependsOn>
      <PackageBuildPath>$(PackageOutputPath)build/</PackageBuildPath>
      <PropsFilePath>$(PackageBuildPath)$(Id).props</PropsFilePath>
  </PropertyGroup>
  <ItemGroup>
    <PackageFile Include="$(PropsFilePath)">
      <TargetPath>build\</TargetPath>
    </PackageFile>
  </ItemGroup>
  <Target Name="GenerateNupkgProps" DependsOnTargets="CalculatePackageVersion">
    <PropertyGroup>
      <PropsFileContents>
&lt;Project&gt;
  &lt;ItemGroup&gt;
    &lt;DotNetCliToolReference Include="$(Id)" Version="$(PackageVersion)" /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
      </PropsFileContents>
    </PropertyGroup>
    <MakeDir Directories="$(PackageBuildPath)"/>  
    <WriteLinesToFile
      File="$(PropsFilePath)"
      Lines="$(PropsFileContents)"
      Overwrite="true" />
  </Target>
</Project>