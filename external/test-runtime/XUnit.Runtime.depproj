<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup Condition="'$(TargetGroup)' == 'uap'">
    <TargetFramework>netstandard2.0</TargetFramework>
    <!-- reset parts so that they can be re-inferred -->
    <TargetFrameworkIdentifier />
    <TargetFrameworkVersion />
  </PropertyGroup>
  <PropertyGroup>
    <!-- Given that xunit packages bring with them part of the framework, we need to specify a runtime in order to get the assets
         The only asset that we copy which is RID-specific is sni.dll which is only used in windows, which is why we default to Windows as the RID -->
    <RuntimeIdentifier>win10-$(ArchGroup)</RuntimeIdentifier>
    <!-- Use xunit for arm packages because of not providing armel package in win10 -->
    <RuntimeIdentifier Condition="'$(ArchGroup)' == 'armel'">win10-arm</RuntimeIdentifier>
    <OutputPath>$(RuntimePath)</OutputPath>
    <MicrosoftDotNetUapTestToolsPackageName>microsoft.dotnet.uap.testtools</MicrosoftDotNetUapTestToolsPackageName>
    <!-- Explicitly set Language to c# to handle the analyzer resolution in nuget -->
    <Language Condition="'$(Language)' == ''">c#</Language>
    <!-- Don't warn if some dependencies were rolled forward -->
    <NoWarn>$(NoWarn);NU1603;NU1701</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Condition="'$(TargetsUap)' == 'true'" Include="$(MicrosoftDotNetUapTestToolsPackageName)" Version="$(MicrosoftDotNetUapTestToolsPackageVersion)" />
  </ItemGroup>

  <!-- Retrieve the UAP Tools to the TestHost folder -->
  <Target Name="CopyUAPToolsToTestHost"
          Condition="'$(TargetGroup)' == 'uap'"
          AfterTargets="AfterResolveReferences">

    <PropertyGroup>
      <UAPToolsFolder Condition="'$(UAPToolsFolder)'==''">$(NuGetPackageRoot)$(MicrosoftDotNetUapTestToolsPackageName)\$(MicrosoftDotNetUapTestToolsPackageVersion)\Tools\$(ArchGroup)</UAPToolsFolder>
      <UAPToolsFolder>$(UAPToolsFolder.Replace('/', '\'))</UAPToolsFolder>
    </PropertyGroup>

    <!-- Give a warning that the UAPToolsFolder is not set and that tests won't run -->
    <Warning Condition="('$(UAPToolsFolder)'=='' or !Exists('$(UAPToolsFolder)')) AND '$(BuildAllConfigurations)' != 'true'" Text="Could not find the UAP Tools at '$(UAPToolsFolder)'. Please run restore." />

    <ItemGroup Condition="'$(UAPToolsFolder)'!=''">
      <RunnerFolderContents Include="$(UAPToolsFolder)\Runner\**\*" />
      <LauncherFolderContents Include="$(UAPToolsFolder)\Launcher\**\*" />
    </ItemGroup>

    <Copy Condition="'$(UAPToolsFolder)'!=''"
          SourceFiles="@(RunnerFolderContents)"
          DestinationFolder="$(TestHostRootPath)\Runner\%(RecursiveDir)"
          SkipUnchangedFiles="true"/>

    <Copy Condition="'$(UAPToolsFolder)'!=''"
          SourceFiles="@(LauncherFolderContents)"
          DestinationFolder="$(TestHostRootPath)\Launcher\%(RecursiveDir)"
          SkipUnchangedFiles="true"/>

  </Target>

</Project>
